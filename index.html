<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; connect-src 'self' https://game-analysis.onrender.com;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理ゲーム・アナライザー Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --game-main: #f8fafc;
            --game-accent: #6366f1;
            --game-dark: #1e293b;
        }
        body { background-color: var(--game-main); color: var(--game-dark); font-family: 'sans-serif'; }
        .game-card { background: white; border: 1px solid #e2e8f0; border-radius: 1.5rem; }
        .ok-box { transition: all 0.3s ease; }
        .ok-badge { padding: 2px 8px; border-radius: 6px; font-weight: bold; font-size: 0.75rem; min-width: 80px; text-align: center; display: inline-block; }
        .badge-ok { background: #dcfce7; color: #166534; }
        .badge-not-ok { background: #fee2e2; color: #991b1b; }
        .badge-none { background: #f1f5f9; color: #94a3b8; }
    </style>
</head>
<body class="min-h-screen pb-12">

    <div class="max-w-2xl mx-auto px-4 py-10">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-indigo-900 leading-tight">心理ゲーム・アナライザー</h1>
            <p class="text-indigo-600 mt-2 font-medium">「OK牧場」の変遷から、隠れたシナリオを暴く</p>
        </header>

        <div id="input-section" class="game-card shadow-xl p-8 space-y-6 border-t-4 border-indigo-500">
            <div>
                <label class="block text-lg font-bold mb-3 text-slate-700">今、どんなやり取りがありましたか？</label>
                <textarea id="user-thought" class="w-full h-32 p-4 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-indigo-400 focus:border-transparent outline-none bg-slate-50 transition placeholder-slate-400" placeholder="例：良かれと思ってアドバイスしたのに、相手が不機嫌になり、最後は私もイライラしてしまった。"></textarea>
            </div>

            <div class="bg-amber-50 border border-amber-200 rounded-2xl p-4 flex items-start space-x-3">
                <span class="text-amber-500 mt-0.5 text-lg">⚠️</span>
                <div class="text-[11px] md:text-xs text-amber-900 leading-relaxed">
                    <p class="font-bold mb-1 underline">ご利用上の注意</p>
                    深刻なリスク（自傷・他害・公序良俗に反する内容等）を伴う入力に対しては、AI側の安全機能が回答をブロックすることがあります。これを繰り返すとAPIの制限によりアプリが使用できなくなる恐れがあるため、中断メッセージが表示された場合は、表現をマイルドにするなど入力を適切に調整してください。
                </div>
            </div>

            <button onclick="analyzeThought()" id="submit-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-indigo-200 text-lg">
                深層心理を分析する
            </button>
        </div>

        <div id="loading" class="hidden text-center py-16">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent"></div>
            <p class="mt-6 text-indigo-800 font-bold">無意識のポジション遷移を解析中...</p>
        </div>

        <div id="result-section" class="hidden space-y-6 mt-8">
            
            <div class="game-card p-6 shadow-md border-l-8 border-indigo-600">
                <h3 class="text-xs font-bold text-indigo-400 uppercase