<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; connect-src 'self' https://game-analysis.onrender.com;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理ゲーム・アナライザー Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --game-main: #f8fafc; --game-accent: #6366f1; --game-dark: #1e293b; }
        body { background-color: var(--game-main); color: var(--game-dark); font-family: sans-serif; }
        .game-card { background: white; border: 1px solid #e2e8f0; border-radius: 1.5rem; }
        .ok-badge { padding: 2px 8px; border-radius: 6px; font-weight: bold; font-size: 0.75rem; min-width: 80px; text-align: center; display: inline-block; }
        .badge-ok { background: #dcfce7; color: #166534; }
        .badge-not-ok { background: #fee2e2; color: #991b1b; }
        .badge-none { background: #f1f5f9; color: #94a3b8; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen pb-12">

    <div class="max-w-2xl mx-auto px-4 py-10">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-indigo-900 leading-tight">心理ゲーム・アナライザー</h1>
            <p class="text-indigo-600 mt-2 font-medium">「OK <-> not OK」の変遷から、隠されたシナリオを暴く</p>
        </header>

        <div id="input-section" class="game-card shadow-xl p-8 space-y-6 border-t-4 border-indigo-500">
            <div>
                <label class="block text-lg font-bold mb-3 text-slate-700">今、どんなやり取りがありましたか？</label>
                <textarea id="user-thought" class="w-full h-32 p-4 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-indigo-400 outline-none bg-slate-50 transition" placeholder="例：良かれと思ってアドバイスしたのに..."></textarea>
            </div>
            <button onclick="analyzeThought()" id="submit-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl transition-all shadow-lg text-lg">
                深層心理を分析する
            </button>
        </div>

        <div id="loading" class="hidden text-center py-16">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent"></div>
            <p class="mt-6 text-indigo-800 font-bold">解析中...</p>
        </div>

        <div id="result-section" class="hidden space-y-6 mt-8 fade-in">
            <div id="raw-result" class="game-card p-6 shadow-md whitespace-pre-wrap text-slate-700 leading-relaxed">
                </div>
            <button onclick="location.reload()" class="w-full py-6 text-slate-400 hover:text-indigo-600 font-bold">戻る</button>
        </div>
    </div>

    <script>
        async function analyzeThought() {
            const thought = document.getElementById('user-thought').value.trim();
            if (!thought) return;

            document.getElementById('input-section').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');

            try {
                const response = await fetch('https://game-analysis.onrender.com/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ "thought": thought })
                });

                const data = await response.json();
                
                // --- 最もシンプルな表示方法 ---
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('result-section').classList.remove('hidden');
                
                // データの中身をきれいに整形して表示
                const resultDiv = document.getElementById('raw-result');
                if (typeof data === 'object') {
                    // AIが返してきたJSONを、人間が読める形式に変換
                    let html = `<h2 class="text-xl font-bold text-indigo-900 mb-4 border-b pb-2">分析結果</h2>`;
                    for (let key in data) {
                        let val = data[key];
                        if (typeof val === 'object') val = JSON.stringify(val, null, 2);
                        html += `<div class="mb-4"><strong class="text-indigo-600">【${key}】</strong><br>${val}</div>`;
                    }
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerText = data;
                }

            } catch (error) {
                alert("エラーが発生しました。");
                location.reload();
            }
        }
    </script>
</body>
</html>